
{% set efi = 'enzymefunctioninitiative/gnd-viewer-bundle' %}
{% set gnd = {
    'app':          efi ~ '/gnd_app',
    'filter':       efi ~ '/gnd_filter',
    'window':       efi ~ '/gnd_gene_window',
    'info_popup':   efi ~ '/gnd_info_popup',
    'loading':      efi ~ '/gnd_loading',
    'search':       efi ~ '/gnd_search_form',
    'canvas':       efi ~ '/gnd_svg_canvas'
} %}

<link rel="stylesheet" href="{{ asset('@enzymefunctioniniative/gnd-viewer-bundle/styles/gnd.css') }}">

{% set app_config = {
    batchSize: params.gnd_batch_size,
    setSize: params.gnd_set_size,
    jobId: params.job_id,
    jobKey: params.job_key,
    api: {
        metadata: params.api_gnd_search,
        record: params.api_gnd_record
    },
    sequence: {
        databaseVersion: params.base_sequence_version|default(""),
        requestedVersion: params.current_sequence_version|default(""),
        unirefId: params.uniref_id,
        metadataUrl: params.metadata_url|default("")
    },
    search: {
        clusterOnLoad: params.search_cluster_on_load|default("")
    }
} %}

<div
    {{ stimulus_controller(gnd.app, { 'app-config': app_config }, {
         (gnd.window): "[data-controller='#{gnd.window|replace({'/': '--'})}']",
         (gnd.search): "[data-controller='#{gnd.search|replace({'/': '--'})}']"
    }) }}
    {{ stimulus_action(gnd.search, 'loadFromSearch', 'submitSearch@window', gnd.app) }}
    {{ stimulus_action(gnd.canvas, 'retrieveAndRenderNextSet', 'batchRenderComplete@window', gnd.app) }}
    {{ stimulus_action(gnd.window, 'updateWindowSize', 'updateWindowSize@window', gnd.app) }}
    >

    {% include('@EfiGndViewer/sidebar.html.twig') with { app_config } %}

    {% include('@EfiGndViewer/canvas.html.twig') with { app_config } %}

    {% include('@EfiGndViewer/footer.html.twig') with { 'app_config': app_config } %}

    {% include('@EfiGndViewer/components/info_popup.html.twig') with { app_config } %}

</div>

